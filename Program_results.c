/****************************************************************************************
* Author: Sheyar Shah
* Last updated: 3-25-14
* Compiler Used: Microsoft Visual Studio 2013 Professional.
* Program Description: Program written in C.
* The program reads in a source file a student wrote and and a system function is used
* to compile a program and than a system function is used to pipe the output of the program
* to a text file (output.txt). The student written program uses an input text file. The output
* of the program is than compared with results which in a seperate text file and tells
* whether the program is correct or not.
* Note: The program has bonus implemented, where the program recieves a numerical grade,
* and also the program is capable of handling expected output files of variable length
*****************************************************************************************/
#include "header.h"

/*
* The result file read is passed here.
* It prints the answer key, so it can later be compared with students answers.
*/
void answerKey(FILE *ptr, int result[], int count){

	/*
	* i used as index for result array.
	* numbers helps print 3 integers per line.
	*/
	int i = 0, numbers = 0;

	while (!feof(ptr)){						//keeps reading ouput from result file, until EOF
		fscanf(ptr, "%d", &result[i]);
		i++;
		count++;
	}

	printf("\nAnser key:\n");
	count--;
	for (i = 0; i < count; i++){
		printf("%d ", result[i]);
		numbers++;							//this is to print to next line, so prints first 3 numbers per line
		if (numbers == 3){
			printf("\n");
			numbers = 0;					//reset the numbers
		}
	}

}

/*
* The information from the output file of student's source code is passed here.
* The part implements the bonus of where the program is capable of handling output files
* of variable length, not just 5 lines. It returns the value of count, which tells how many
* elements of integers are from the output of the program.
*/
int count_program_results(FILE *ptr, int output[]){

	/*
	* i is used as index to store information in array.
	* count is variable keeping track of how many output elements of integers are from program.
	*/
	int i = 0, count = 0;

	if ((ptr = fopen("output.txt", "r")) == NULL){			//reads the output file created from system function for selected program
		printf("Error reading a file or file is empty");

	}

	while (!feof(ptr)){										//keeps reading ouput generated by student source code, until EOF
		fscanf(ptr, "%d", &output[i]);
		i++;												//incrementing, in order to read the next element in an array
		count++;											//keeping track of how many elements there are
	}
	count--;

	return count;											//returns the value of count, telling how many ouputs results were created
}

/*
* The information is passed from result file, output file, and count which holds how many elements have been read.
* First, the output generated from a given program is printed. Than the output result is compared with the answer key
* or actual results and tells whether the output is correct or not. In addition, it also gives a numerical grade.
* Each correct result or number is about 6.67 points and gives the grade accordingly.
*/
int grade_program(FILE *ptr, int output[], int result[], int count){

	/*
	* wrong tells how many output results were wrong, correct tells us how many output results were correct.
	* numbers is used to make the output created from program neat. It prints 3 integers on each line.
	* grade is intilized to 100 and subtracts 6.67 points, if any wrong is ouput result is found.
	*/
	int i, wrong = 0, correct = 0, numbers = 0;
	float grade = 100;

	printf("\nOutput generated by program\n");

	for (i = 0; i < count; i++){
		printf("%d ", output[i]);
		numbers++;							//this is to print to next line, so prints first 3 numbers per line
		if (numbers == 3){
			printf("\n");
			numbers = 0;					//reset the numbers
		}
	}
	/*
	* The checking and grading of the program is done here.
	*/
	for (i = 0; i < count; i++){
		if (output[i] == result[i]){
			correct++;
		}
		else{
			wrong++;
			grade = grade - 6.67;
		}

	}

	if (correct == count){
		printf("\nThe output of the program is correct.");
		printf("\nThe grade is %.2f ", grade);
	}

	else{
		printf("\nThe output of the program is incorrect.");
		printf("\nEach correct output is about 6.67 points, so there were %d wrong numbers", wrong);
		printf("\nThe grade is %.2f ", grade);
	}

	return 0;
}

